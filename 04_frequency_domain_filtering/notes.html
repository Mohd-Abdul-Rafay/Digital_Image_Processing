<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Module 04 Notes — Fourier Analysis + Gaussian Low-Pass Filtering</title>
  <style>
    :root{
      --bg:#0b1220; --card:#101a2e; --muted:#95a3b8; --text:#e7eefc;
      --accent:#6ee7ff; --accent2:#a78bfa; --ok:#34d399; --warn:#fbbf24;
      --border:rgba(255,255,255,.08);
      --code:#0a1020; --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }
    *{box-sizing:border-box}
    body{margin:0; font-family:var(--sans); background:radial-gradient(1200px 800px at 20% 0%, #111f3f 0%, var(--bg) 45%, #070b14 100%); color:var(--text);}
    a{color:var(--accent); text-decoration:none}
    a:hover{text-decoration:underline}
    .wrap{max-width:1150px; margin:0 auto; padding:28px 18px 70px}
    header{
      border:1px solid var(--border);
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border-radius:18px; padding:22px 20px; box-shadow:0 16px 40px rgba(0,0,0,.35);
    }
    h1{margin:0 0 8px; font-size:28px; letter-spacing:.2px}
    .sub{margin:0; color:var(--muted); line-height:1.5}
    .pillrow{display:flex; flex-wrap:wrap; gap:10px; margin-top:14px}
    .pill{
      border:1px solid var(--border); background:rgba(255,255,255,.04);
      padding:8px 10px; border-radius:999px; color:var(--muted); font-size:13px;
    }
    .grid{display:grid; grid-template-columns: 1.2fr .8fr; gap:16px; margin-top:16px}
    @media (max-width: 980px){ .grid{grid-template-columns:1fr} }
    .card{
      border:1px solid var(--border); background:rgba(16,26,46,.72);
      border-radius:16px; padding:16px 16px; box-shadow:0 10px 28px rgba(0,0,0,.28);
    }
    h2{margin:0 0 10px; font-size:18px}
    h3{margin:14px 0 8px; font-size:15px; color:#dbe7ff}
    p{margin:8px 0; color:var(--text); line-height:1.65}
    .muted{color:var(--muted)}
    code, pre{font-family:var(--mono)}
    pre{
      margin:10px 0; padding:12px; border-radius:14px;
      border:1px solid var(--border); background:var(--code);
      overflow:auto;
    }
    .list{margin:8px 0 0; padding-left:18px; line-height:1.55}
    .list li{margin:6px 0}
    details{
      border:1px solid var(--border); border-radius:14px; padding:10px 12px;
      background:rgba(255,255,255,.03); margin:10px 0;
    }
    details summary{cursor:pointer; font-weight:600; color:#dbe7ff}
    .tbl{width:100%; border-collapse:separate; border-spacing:0; overflow:hidden; border-radius:14px; border:1px solid var(--border); margin-top:10px}
    .tbl th,.tbl td{padding:10px 10px; border-bottom:1px solid var(--border); vertical-align:top}
    .tbl th{color:#dbe7ff; text-align:left; background:rgba(255,255,255,.04)}
    .tbl tr:last-child td{border-bottom:none}
    .lab{
      border:1px solid var(--border); border-radius:14px; padding:12px;
      background:rgba(255,255,255,.03); margin-top:10px;
    }
    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    select,input[type="range"]{width:100%; accent-color: var(--accent)}
    .btn{
      display:inline-flex; align-items:center; gap:8px;
      border:1px solid var(--border);
      background:linear-gradient(180deg, rgba(110,231,255,.16), rgba(110,231,255,.06));
      color:var(--text); padding:10px 12px; border-radius:12px;
      cursor:pointer; user-select:none;
    }
    .btn:hover{filter:brightness(1.06)}
    .out{
      margin-top:10px; padding:12px; border-radius:14px;
      border:1px solid var(--border); background:rgba(52,211,153,.08);
      color:#d7fff0;
      display:none;
    }
    .warn{background:rgba(251,191,36,.08); color:#fff3d1;}
    .tag{display:inline-block; padding:2px 8px; border-radius:999px; border:1px solid var(--border); color:var(--muted); font-size:12px}
    .kpi{
      display:grid; grid-template-columns: repeat(3, 1fr); gap:10px; margin-top:10px;
    }
    @media (max-width: 740px){ .kpi{grid-template-columns:1fr} }
    .kpi .box{
      border:1px solid var(--border); border-radius:14px; background:rgba(255,255,255,.03);
      padding:12px;
    }
    .kpi .box b{display:block; margin-bottom:4px}
    footer{margin-top:18px; color:var(--muted); font-size:13px}
    .eq{
      display:block; padding:10px 12px; border-radius:14px;
      border:1px dashed rgba(255,255,255,.16); background:rgba(167,139,250,.06);
      font-family:var(--mono); overflow:auto;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>04 — Fourier Analysis + Gaussian Low-Pass Filtering (Frequency vs Spatial)</h1>
      <p class="sub">
        Notes for the MATLAB pipeline that visualizes the <b>2D Fourier Transform</b> (magnitude + phase), applies a
        <b>Gaussian low-pass filter (LPF)</b> in the <b>frequency domain</b>, reconstructs with <b>inverse FFT</b>, and compares
        with an equivalent <b>spatial Gaussian smoothing</b> (<code>imgaussfilt</code>) using an <b>absolute difference</b> map.
      </p>
      <div class="pillrow">
        <span class="pill">Input: <code>input/onion.png</code></span>
        <span class="pill">Outputs: <code>output/01..04_*.png</code> + filtered images</span>
        <span class="pill">Core ops: <code>fft2</code>, <code>fftshift</code>, <code>ifft2</code>, <code>ifftshift</code>, <code>imgaussfilt</code></span>
      </div>
    </header>

    <div class="grid">
      <section class="card">
        <h2>1) Big idea (what you’re proving)</h2>
        <p class="muted">
          The Fourier transform decomposes an image into <b>spatial frequencies</b>. A low-pass filter keeps
          <b>slowly varying</b> components (global structure) and suppresses <b>rapid changes</b> (edges, fine texture, noise).
          A <b>Gaussian LPF</b> in frequency space corresponds to <b>Gaussian smoothing</b> in spatial space (up to boundary details and parameterization).
        </p>

        <div class="kpi">
          <div class="box">
            <b>Low frequency</b>
            <div class="muted">Large structures, smooth illumination, gradual transitions.</div>
          </div>
          <div class="box">
            <b>High frequency</b>
            <div class="muted">Edges, sharp detail, fine texture, noise.</div>
          </div>
          <div class="box">
            <b>Gaussian LPF</b>
            <div class="muted">Smooth attenuation (no hard cutoff) → fewer ringing artifacts.</div>
          </div>
        </div>

        <details>
          <summary>Why magnitude and phase are separated</summary>
          <p class="muted">
            In general, <b>magnitude</b> encodes “how much” of each frequency exists; <b>phase</b> encodes “where” structures are located.
            Phase is critical for geometric structure. If you keep phase but randomize magnitude, you often still perceive recognizable structure;
            if you keep magnitude but randomize phase, structure collapses.
          </p>
        </details>

        <h3>Key equations (conceptual)</h3>
        <div class="eq">
          F(u,v) = Σₓ Σᵧ f(x,y) · e^{-j2π(ux/M + vy/N)}<br/>
          f(x,y) = (1/MN) Σᵤ Σᵥ F(u,v) · e^{+j2π(ux/M + vy/N)}<br/><br/>
          H(u,v) = exp(-(u²+v²)/(2σ²))  &nbsp; (Gaussian LPF)<br/>
          F_LPF(u,v) = F(u,v) · H(u,v)
        </div>

        <details>
          <summary>Why the magnitude plot uses log scaling</summary>
          <p class="muted">
            Fourier magnitudes typically span orders of magnitude (DC component is huge). <code>log(1+|F|)</code> compresses the range so mid/high-frequency content becomes visible.
          </p>
        </details>
      </section>

      <aside class="card">
        <h2>2) Mapping code → theory</h2>

        <table class="tbl">
          <thead>
            <tr><th>Code block</th><th>What it means</th></tr>
          </thead>
          <tbody>
            <tr>
              <td><b>fft2 + fftshift</b></td>
              <td>Compute 2D spectrum; shift DC (zero frequency) to the center so filters are easy to define radially.</td>
            </tr>
            <tr>
              <td><b>abs / angle</b></td>
              <td><code>abs(F)</code> = magnitude, <code>angle(F)</code> = phase.</td>
            </tr>
            <tr>
              <td><b>Gaussian H(u,v)</b></td>
              <td>Radially symmetric low-pass. Larger σ → wider passband (less blur). Smaller σ → stronger blur.</td>
            </tr>
            <tr>
              <td><b>ifftshift + ifft2</b></td>
              <td>Undo shift and reconstruct spatial image from filtered spectrum.</td>
            </tr>
            <tr>
              <td><b>imgaussfilt</b></td>
              <td>Spatial-domain convolution with a Gaussian kernel (LPF).</td>
            </tr>
            <tr>
              <td><b>abs(spatial - freq)</b></td>
              <td>Highlights differences due to parameter mismatch, padding/boundaries, numeric details.</td>
            </tr>
          </tbody>
        </table>

        <div class="lab">
          <h3>Practical note: σ in frequency vs σ in spatial</h3>
          <p class="muted">
            <b>They are not numerically identical</b>. Your code uses <code>sigmaFreq = 20</code> (in frequency-grid units)
            and <code>sigmaSpatial = 2</code> (in pixels). Matching them exactly requires mapping between pixel-domain σ
            and frequency-domain σ based on image size and DFT conventions. For this module, the goal is conceptual equivalence + qualitative comparison.
          </p>
        </div>

        <details>
          <summary>Why Gaussian (soft) cutoff is preferred to ideal (hard) cutoff</summary>
          <p class="muted">
            An ideal LPF (hard circular cutoff) introduces <b>ringing</b> (Gibbs phenomenon) in spatial domain (sinc-like impulse response).
            Gaussian attenuation avoids sharp transitions → fewer ringing artifacts.
          </p>
        </details>
      </aside>
    </div>

    <section class="card" style="margin-top:16px;">
      <h2>3) Topics you should know around this code (complete map)</h2>

      <h3>A) Spatial frequency intuition</h3>
      <ul class="list">
        <li><b>Edges</b> are high frequency because intensity changes abruptly.</li>
        <li><b>Blurring</b> reduces high frequency (smooths transitions), which reduces noise but also softens edges.</li>
        <li><b>Textures</b> occupy bands of mid/high frequencies depending on scale.</li>
      </ul>

      <h3>B) DFT assumptions and artifacts</h3>
      <ul class="list">
        <li><b>Periodicity assumption:</b> DFT treats the image as repeating. Discontinuities at borders create high-frequency energy.</li>
        <li><b>Spectral leakage:</b> abrupt border changes or non-integer periodic patterns spread energy across frequencies.</li>
        <li><b>Padding effects:</b> spatial filtering with <code>Padding="replicate"</code> is not the same as periodic wrap in FFT land.</li>
      </ul>

      <details>
        <summary>Why your difference image is not zero (even if both are Gaussian LPF)</summary>
        <ul class="list">
          <li>Different σ parameterization (<code>sigmaFreq</code> vs <code>sigmaSpatial</code>).</li>
          <li>Different boundary handling: <code>imgaussfilt(...,"Padding","replicate")</code> vs FFT’s implicit periodic model.</li>
          <li>Discrete sampling: frequency grid uses integer indices; Gaussian kernel size is finite in spatial.</li>
          <li>Numeric effects: floating point + clamping.</li>
        </ul>
      </details>

      <h3>C) Filtering fundamentals</h3>
      <ul class="list">
        <li><b>Linear shift-invariant (LSI) systems:</b> convolution in spatial ↔ multiplication in frequency.</li>
        <li><b>Impulse response:</b> spatial kernel is the impulse response; frequency response is its Fourier transform.</li>
        <li><b>Low-pass / high-pass / band-pass:</b> defined by what frequency ranges are preserved.</li>
        <li><b>Gaussian is special:</b> Fourier transform of a Gaussian is also Gaussian (shape preserved).</li>
      </ul>

      <h3>D) Magnitude vs phase (what matters most)</h3>
      <ul class="list">
        <li><b>Phase</b> often dominates perceived structure (alignment/geometry).</li>
        <li><b>Magnitude</b> controls energy at different scales; it affects contrast/texture strength.</li>
        <li>Many classic demos: “phase-only reconstruction” still shows recognizable objects.</li>
      </ul>
    </section>

    <section class="card" style="margin-top:16px;">
      <h2>4) How to interpret your outputs (01–04)</h2>

      <table class="tbl">
        <thead>
          <tr><th>Output</th><th>What to look for</th><th>What it implies</th></tr>
        </thead>
        <tbody>
          <tr>
            <td><b>01_fft_magnitude_phase.png</b></td>
            <td>Bright center = strong low-frequency energy; phase looks “random-like” but is structured.</td>
            <td>Natural images concentrate energy in low frequencies.</td>
          </tr>
          <tr>
            <td><b>02_reconstruction_freq_lpf.png</b></td>
            <td>Smoother image; edges softened; noise reduced.</td>
            <td>High-frequency attenuation in spectral domain.</td>
          </tr>
          <tr>
            <td><b>03_reconstruction_spatial_lpf.png</b></td>
            <td>Similar blur; small differences at borders or fine textures.</td>
            <td>Spatial Gaussian approximates the same low-pass behavior.</td>
          </tr>
          <tr>
            <td><b>04_abs_difference.png</b></td>
            <td>Differences often near boundaries and sharp edges.</td>
            <td>Boundary handling + parameter mismatch are dominating sources.</td>
          </tr>
        </tbody>
      </table>

      <details>
        <summary>Best practice: pick one “matching” strategy if you want closer equivalence</summary>
        <ul class="list">
          <li>Use consistent boundary assumptions (e.g., pad the image before FFT, or use wrap padding in spatial).</li>
          <li>Choose σ mapping deliberately (derive from desired cutoff frequency or desired spatial blur).</li>
          <li>Keep everything in double and avoid early clamping before diff.</li>
        </ul>
      </details>

      <footer>
        README tip: add a line — <code>See notes.html for Fourier/LPF theory, artifacts, and how to interpret outputs.</code>
      </footer>
    </section>

    <section class="card" style="margin-top:16px;">
      <h2>5) Quick checks (interactive)</h2>
      <p class="muted">These checks validate understanding. They don’t modify your outputs.</p>

      <div class="lab">
        <h3>Check 1: What does increasing σ do?</h3>
        <div class="row">
          <div style="flex:1; min-width:240px;">
            <label class="muted">Domain</label>
            <select id="dom">
              <option value="">Select…</option>
              <option value="spatial">Spatial Gaussian (σ in pixels)</option>
              <option value="freq">Frequency Gaussian (σ on frequency grid)</option>
            </select>
          </div>
          <div style="flex:1; min-width:240px;">
            <label class="muted">Effect of increasing σ</label>
            <select id="eff">
              <option value="">Select…</option>
              <option value="less">Less blur (wider passband)</option>
              <option value="more">More blur (narrower passband)</option>
            </select>
          </div>
        </div>
        <button class="btn" style="margin-top:10px;" onclick="grade1()">Check</button>
        <div id="out1" class="out"></div>
      </div>

      <div class="lab">
        <h3>Check 2: Why is log scaling used for magnitude?</h3>
        <select id="why">
          <option value="">Select…</option>
          <option value="a">To compress dynamic range so mid/high frequencies are visible</option>
          <option value="b">To remove phase information</option>
          <option value="c">To make the FFT invertible</option>
        </select>
        <button class="btn" style="margin-top:10px;" onclick="grade2()">Check</button>
        <div id="out2" class="out"></div>
      </div>

      <div class="lab">
        <h3>Check 3: Why does the diff image highlight borders?</h3>
        <select id="why2">
          <option value="">Select…</option>
          <option value="a">FFT assumes periodic boundaries; spatial filter used replicate padding</option>
          <option value="b">Because Gaussian filters only work on borders</option>
          <option value="c">Because phase is always zero at borders</option>
        </select>
        <button class="btn" style="margin-top:10px;" onclick="grade3()">Check</button>
        <div id="out3" class="out"></div>
      </div>
    </section>
  </div>

  <script>
    function show(el, msg, warn=false){
      el.textContent = msg;
      el.style.display = "block";
      el.classList.toggle("warn", warn);
    }
    function grade1(){
      const d = document.getElementById("dom").value;
      const e = document.getElementById("eff").value;
      const out = document.getElementById("out1");
      if(!d || !e){ show(out, "Select both domain and effect.", true); return; }

      // Spatial: larger sigma = more blur.
      // Frequency Gaussian (as coded): larger sigmaFreq = broader Gaussian in freq => passes more => less blur.
      if(d === "spatial" && e === "more"){
        show(out, "Correct. Spatial σ↑ → smoother kernel → more blur.");
      } else if(d === "freq" && e === "less"){
        show(out, "Correct for your frequency-domain parameterization: σfreq↑ → wider passband → less blur.");
      } else {
        show(out, "Not quite. Spatial σ↑ → more blur. In your frequency-domain Gaussian LPF, σfreq↑ → less blur (wider passband).", true);
      }
    }
    function grade2(){
      const v = document.getElementById("why").value;
      const out = document.getElementById("out2");
      if(!v){ show(out, "Pick an option.", true); return; }
      if(v === "a") show(out, "Correct. Log compresses dynamic range so you can see non-DC components.");
      else show(out, "Incorrect. Log scaling is for visibility (dynamic range compression).", true);
    }
    function grade3(){
      const v = document.getElementById("why2").value;
      const out = document.getElementById("out3");
      if(!v){ show(out, "Pick an option.", true); return; }
      if(v === "a") show(out, "Correct. Boundary assumptions differ: FFT periodic vs spatial replicate padding.");
      else show(out, "Incorrect. The main cause is boundary handling + parameter mismatch.", true);
    }
  </script>
</body>
</html>
